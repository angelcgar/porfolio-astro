---
// Componente
import CardProjects from '@/components/CardProjects.astro';
import SharedAnchor from '@/components/SharedAnchor.astro';
import Title from '@/components/Title.astro';

// api
import type { Proyectos } from '@/pages/api/proyectos.json';
import { envs } from '@/config/envs';

const data = await fetch(`${envs.PATH_ROOT_URL}/api/data`);
const res: Proyectos[] = await data.json();
const filteredProjects = res.filter(
  (p) => p.category === envs.PROJECT_CATEGORY
);
const selectedProjects = filteredProjects.slice(0, 4);

const projectsByImportance = Object.groupBy(
  selectedProjects,
  ({ prioridad }) => prioridad!
);

let allProject: Proyectos[] = [];

if (projectsByImportance['!!1']) {
  allProject = [...allProject, ...projectsByImportance['!!1']];
}
if (projectsByImportance['!!2']) {
  allProject = [...allProject, ...projectsByImportance['!!2']];
}
if (projectsByImportance['!!3']) {
  allProject = [...allProject, ...projectsByImportance['!!3']];
}
if (projectsByImportance['!!4']) {
  allProject = [...allProject, ...projectsByImportance['!!4']];
}

// console.log({ allProject });
---

<section class="container p-5 mx-1 my-4 rounded-md md:p-10">
  <Title class=""> My projects </Title>

  <div class="grid gap-6 mt-10 md:grid-cols-2">
    {
      allProject.map((project) => (
        <div>
          <a href={`/projects/${project.id}`}>
            <CardProjects project={project} />
          </a>
        </div>
      ))
    }
  </div>

  <div class="flex items-center justify-center">
    <SharedAnchor
      slot="More projects"
      arialLabel="view more projects"
      href="/mas-proyectos"
    />
  </div>
</section>
